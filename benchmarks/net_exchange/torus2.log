mkdir -p /home/gorygrey/Apps/RSE/build/net_exchange/torus2
gcc -Wall -Wextra -O2 -ffreestanding -fno-stack-protector -fno-pic -fno-pie -mno-red-zone -mcmodel=kernel -nostdlib -nostartfiles -fno-builtin -std=c11 -I/usr/include/efi -I/usr/include/efi/x86_64 -DHAVE_USE_MS_ABI -DRSE_TORUS_ID=2 -DRSE_NET_EXCHANGE=0 -DRSE_SHM_EXCHANGE=1 -DRSE_NET_RAW=0 -c boot/kernel.c -o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/kernel.o
gcc -Wall -Wextra -O2 -ffreestanding -fno-stack-protector -fno-pic -fno-pie -mno-red-zone -mcmodel=kernel -nostdlib -nostartfiles -fno-builtin -std=c11 -I/usr/include/efi -I/usr/include/efi/x86_64 -DHAVE_USE_MS_ABI -DRSE_TORUS_ID=2 -DRSE_NET_EXCHANGE=0 -DRSE_SHM_EXCHANGE=1 -DRSE_NET_RAW=0 -c boot/init.c -o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/init.o
g++ -Wall -Wextra -O2 -ffreestanding -fno-stack-protector -fno-pic -fno-pie -mno-red-zone -mcmodel=kernel -nostdlib -nostartfiles -fno-builtin -std=c++20 -fno-exceptions -fno-rtti -fno-use-cxa-atexit -DRSE_KERNEL -DRSE_TORUS_ID=2 -DRSE_NET_EXCHANGE=0 -DRSE_SHM_EXCHANGE=1 -DRSE_NET_RAW=0 -c boot/kernel_os.cpp -o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/kernel_os.o
g++ -Wall -Wextra -O2 -ffreestanding -fno-stack-protector -fno-pic -fno-pie -mno-red-zone -mcmodel=kernel -nostdlib -nostartfiles -fno-builtin -std=c++20 -fno-exceptions -fno-rtti -fno-use-cxa-atexit -DRSE_KERNEL -DRSE_TORUS_ID=2 -DRSE_NET_EXCHANGE=0 -DRSE_SHM_EXCHANGE=1 -DRSE_NET_RAW=0 -c boot/net_projection.cpp -o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/net_projection.o
gcc -Wall -Wextra -O2 -ffreestanding -fno-stack-protector -fno-pic -fno-pie -mno-red-zone -mcmodel=kernel -nostdlib -nostartfiles -fno-builtin -std=c11 -I/usr/include/efi -I/usr/include/efi/x86_64 -DHAVE_USE_MS_ABI -DRSE_TORUS_ID=2 -DRSE_NET_EXCHANGE=0 -DRSE_SHM_EXCHANGE=1 -DRSE_NET_RAW=0 -T boot/linker.ld -nostdlib -Wl,-z,max-page-size=0x1000 -no-pie -o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/kernel.elf /home/gorygrey/Apps/RSE/build/net_exchange/torus2/kernel.o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/kernel_os.o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/net_projection.o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/init.o
gcc -I/usr/include/efi -I/usr/include/efi/x86_64 -fPIC -fshort-wchar -mno-red-zone -ffreestanding -fno-stack-protector -fcf-protection=none -DHAVE_USE_MS_ABI -O2 -Wall -Wextra -c boot/uefi_loader.c -o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/uefi_loader.o
objcopy -j .text -j .sdata -j .data -j .dynamic -j .dynsym \
	-j .rel* -j .rela* -j .reloc --target=efi-app-x86_64 /home/gorygrey/Apps/RSE/build/net_exchange/torus2/uefi_loader.so /home/gorygrey/Apps/RSE/build/net_exchange/torus2/BOOTX64.EFI
rm -f /home/gorygrey/Apps/RSE/build/net_exchange/torus2/esp.img
mkfs.fat -F16 -C /home/gorygrey/Apps/RSE/build/net_exchange/torus2/esp.img 65536
mkfs.fat 4.2 (2021-01-31)
mmd -i /home/gorygrey/Apps/RSE/build/net_exchange/torus2/esp.img ::/EFI
mmd -i /home/gorygrey/Apps/RSE/build/net_exchange/torus2/esp.img ::/EFI/BOOT
mcopy -D o -i /home/gorygrey/Apps/RSE/build/net_exchange/torus2/esp.img /home/gorygrey/Apps/RSE/build/net_exchange/torus2/BOOTX64.EFI ::/EFI/BOOT/BOOTX64.EFI
mcopy -D o -i /home/gorygrey/Apps/RSE/build/net_exchange/torus2/esp.img /home/gorygrey/Apps/RSE/build/net_exchange/torus2/kernel.elf ::/kernel.elf
rm -rf /home/gorygrey/Apps/RSE/build/net_exchange/torus2/efi_iso
mkdir -p /home/gorygrey/Apps/RSE/build/net_exchange/torus2/efi_iso/EFI/BOOT
cp /home/gorygrey/Apps/RSE/build/net_exchange/torus2/esp.img /home/gorygrey/Apps/RSE/build/net_exchange/torus2/efi_iso/esp.img
# Put loader in ISO root so FS0 can find it.
cp /home/gorygrey/Apps/RSE/build/net_exchange/torus2/BOOTX64.EFI /home/gorygrey/Apps/RSE/build/net_exchange/torus2/efi_iso/EFI/BOOT/BOOTX64.EFI
cp /home/gorygrey/Apps/RSE/build/net_exchange/torus2/kernel.elf /home/gorygrey/Apps/RSE/build/net_exchange/torus2/efi_iso/kernel.elf
xorriso -as mkisofs -R -J -V "RSEEFI" \
	-eltorito-alt-boot -e esp.img -no-emul-boot \
	-isohybrid-gpt-basdat -append_partition 2 0xef /home/gorygrey/Apps/RSE/build/net_exchange/torus2/efi_iso/esp.img \
	-appended_part_as_gpt -o /home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_efi.iso /home/gorygrey/Apps/RSE/build/net_exchange/torus2/efi_iso
xorriso 1.5.6 : RockRidge filesystem manipulator, libburnia project.

Drive current: -outdev 'stdio:/home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_efi.iso'
Media current: stdio file, overwriteable
Media status : is blank
Media summary: 0 sessions, 0 data blocks, 0 data,  172g free
Added to ISO image: directory '/'='/home/gorygrey/Apps/RSE/build/net_exchange/torus2/efi_iso'
xorriso : UPDATE :       6 files added in 1 seconds
xorriso : UPDATE :       6 files added in 1 seconds
xorriso : WARNING : Boot image load size exceeds 65535 blocks of 512 bytes. Will record 0 in El Torito to extend ESP to end-of-medium.
xorriso : UPDATE :  23.87% done
xorriso : UPDATE : Thank you for being patient. Working since 1 seconds.
ISO image produced: 66234 sectors
Written to medium : 66234 sectors at LBA 0
Writing to 'stdio:/home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_efi.iso' completed successfully.

rm -f /home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_data.img
mkfs.fat -F32 -C /home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_data.img 65536
mkfs.fat 4.2 (2021-01-31)
rm -f /home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_raw.img
dd if=/dev/zero of=/home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_raw.img bs=1M count=64
64+0 records in
64+0 records out
67108864 bytes (67 MB, 64 MiB) copied, 0.135403 s, 496 MB/s
rm -f /home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_virtio.img
dd if=/dev/zero of=/home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_virtio.img bs=1M count=64
64+0 records in
64+0 records out
67108864 bytes (67 MB, 64 MiB) copied, 0.0824074 s, 814 MB/s
cp /usr/share/OVMF/OVMF_VARS_4M.fd /home/gorygrey/Apps/RSE/build/net_exchange/torus2/OVMF_VARS.fd
qemu-system-x86_64 -machine q35 -m 512M \
	-drive if=pflash,format=raw,readonly=on,file=/usr/share/OVMF/OVMF_CODE_4M.fd \
	-drive if=pflash,format=raw,file=/home/gorygrey/Apps/RSE/build/net_exchange/torus2/OVMF_VARS.fd \
	-cdrom /home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_efi.iso -boot order=d \
	-device qemu-xhci,id=xhci \
	-device usb-tablet \
	-drive if=none,format=raw,file=/home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_data.img,id=usbdisk \
	-device usb-storage,drive=usbdisk \
	-drive if=none,format=raw,file=/home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_raw.img,id=usbraw \
	-device usb-storage,drive=usbraw \
	-drive if=none,format=raw,file=/home/gorygrey/Apps/RSE/build/net_exchange/torus2/rse_virtio.img,id=vdisk \
	-device virtio-blk-pci,drive=vdisk \
	 \
	-object memory-backend-file,id=ivshmem,share=on,mem-path=/home/gorygrey/Apps/RSE/build/net_exchange/ivshmem.bin,size=65536 -device ivshmem-plain,memdev=ivshmem \
	-serial stdio -display none
[2J[01;01H[=3h[2J[01;01H[2J[01;01H[=3h[2J[01;01H[2J[01;01H[=3h[2J[01;01HBdsDxe: loading Boot0001 "UEFI QEMU DVD-ROM QM00005 " from PciRoot(0x0)/Pci(0x1F,0x2)/Sata(0x2,0xFFFF,0x0)
BdsDxe: starting Boot0001 "UEFI QEMU DVD-ROM QM00005 " from PciRoot(0x0)/Pci(0x1F,0x2)/Sata(0x2,0xFFFF,0x0)
[RSE] UEFI loader start
[RSE] UEFI loader start
[RSE] load_file start
[RSE] BootServices=0x000000001feaff00
[RSE] HandleProtocol=0x000000001fe9c997
[RSE] load_file loaded_image ok
[RSE] load_file fs ok
[RSE] load_file open volume ok
[RSE] load_file open file ok
[RSE] load_file getinfo ok
[RSE] load_file alloc ok
[RSE] load_file read ok
[RSE] Kernel read ok
[RSE] seg paddr=0x0000000010000000 memsz=0x0000000000018120 pages=0x0000000000000019
[RSE] seg paddr=0x0000000010019000 memsz=0x0000000002862a78 pages=0x0000000000002863
[RSE] Kernel load ok
[RSE] GOP framebuffer ok
[RSE] Jumping to kernel
[RSE] Jumping to kernel
[RSE] UEFI kernel start
[RSE] UEFI framebuffer online
[RSE] benchmarks begin
[RSE] init workloads start
[RSE] braided smoke start
[RSE] braid cycles=3 ticks=300
[RSE] braid A events=300 active=4 edges=1 pending=1
[RSE] braid B events=300 active=4 edges=1 pending=1
[RSE] braid C events=300 active=4 edges=1 pending=1
[RSE] braided smoke done
[RSE] UEFI net online
[RSE] torus init 0
[user] fs start pid=1 torus=0
[init] start
[init] torus=0
[init] compute ops=2000000 cycles=112009658 checksum=9791868472914447520
[init] pipe stage0 q0=8064 q1=8064 cycles=2473712
[init] using /persist
[init] memfs ops=640 bytes=524288 cycles=2958980279
[init] block device test
[init] /dev/blk0 size=512 ops=256 bytes=131072 mismatches=0 cycles=2236119035
[init] loopback test
[init] loopback wrote=13 read=13
rse> help
help: echo, cat, ls, probe, ps
rse> ps
ps: torus=0 pid=1
rse> echo shell-online
shell-online
rse> cat /persist/hello.txt
hello from RSE shell
rse> ls /
ls: empty

rse> ls /persist
user.txt
hello.txt

rse> probe devices
probe /dev/blk0 ok
probe /dev/net0 ok
probe /dev/loopback ok
[RSE] torus init 1
[user] net start pid=1 torus=1
[init] start
[init] torus=1
[init] compute ops=6000000 cycles=190076211 checksum=8086429594797147306
[init] memstress bytes=16777216 cycles=449759592 checksum=2139095040
[init] pipe stage1 in=8064 out=8064 cycles=1506345 checksum=1544256
[RSE] torus init 2
[user] compute start pid=1 torus=2
[user] compute cycles=394653 checksum=9537272341150758256
[init] start
[init] torus=2
[init] compute ops=2000000 cycles=30568861 checksum=9791868472914447520
[init] pipe stage2a in=8064 out=8064 cycles=3163665 checksum=516109
[init] pipe stage2b in=16128 wrote=16128 cycles=11099075 checksum=2060365
[init] net0 test
[init] net0 wrote=16384 read=16384 cycles=12364580
[RSE] userspace run start
[RSE] userspace run done
[RSE] braid scheduler start
[RSE] torus load a=5 b=1 c=0
[user] net rx timeout
[RSE] torus load a=5 b=1 c=0
[RSE] os braid cycles=1
[RSE] braid scheduler done
[RSE] shm projection online
[RSE] shm projection exchange start
[RSE] shm projection acked seq=1
[RSE] shm projection recv torus=0 seq=1
[RSE] shm projection recv torus=1 seq=1
[RSE] compute benchmark start
[RSE] compute ops=400000 cycles=24382672 cycles/op=60 checksum=4180332335208930419
[RSE] memory benchmark start
[RSE] memory bytes=67108864 cycles=5574656816 cycles/byte=83
[RSE] ramfs benchmark start
[RSE] ramfs ops=288 cycles=10623493 cycles/op=36887 checksum=12533760 files=0
[RSE] UEFI FS benchmark start
[RSE] UEFI FS ops=144 cycles=2775151856 cycles/op=19271887 checksum=12533760
[RSE] UEFI block benchmark start
[RSE] UEFI block bytes=524288 write cycles=15994025 write cycles/byte=30 read cycles=37362052 read cycles/byte=71 checksum=66846720
[RSE] virtio-blk capacity=131072
[RSE] virtio-blk modern online
[RSE] virtio-blk benchmark start
[RSE] virtio desc req=509022208 data=268541952 status=509022336
[RSE] virtio-blk notify idx=0 used=0
[RSE] virtio-blk notify idx=1 used=1
[RSE] virtio-blk bytes=512 write cycles=445954769 write cycles/byte=871005 read cycles=1889020 read cycles/byte=3689 checksum=65280
[RSE] udp/http server benchmark start
[RSE] udp/http server rx=0 udp=0 http=0 cycles=534835315
[RSE] http loopback benchmark start
[RSE] http requests=50000 cycles=71827127 cycles/req=1436 checksum=218650000
[RSE] benchmarks end
[RSE] UEFI pointer online
[RSE] UEFI keyboard online
qemu-system-x86_64: terminating on signal 15 from pid 297911 (make)
